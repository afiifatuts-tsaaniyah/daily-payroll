<?php namespace App\Models\Report; 
/*********************************************************************
 *  Created By       :  Generator Version 1.0.23                     *
 *  Created Date     :  Aug 18, 2020                                 *
 *  Description      : All code generated by model generator         *
 *  Generator Author : Tommy Maurice(tommy_maurice@yahoo.com)        *
 *********************************************************************/
use CodeIgniter\Model;

class M_mtb_thr extends Model
{
     /* START PRIVATE VARIABLES */
     protected $DBGroup = 'hris';
     protected $table = 'tr_slip';
     protected $primaryKey = 'slip_id';
     protected $returnType = 'array';
     protected $db = null;

    public function getDataEmpByDept($startYears, $endYears, $dept)
    {
          $stQuery = "SELECT DISTINCT a.biodata_id, b.monthly, b.daily, b.account_no, b.status_payroll, c.full_name FROM rp_db a, mt_salary b, mt_biodata_01 c WHERE a.biodata_id = b.biodata_id AND a.biodata_id = c.biodata_id AND a.date_process BETWEEN '".$startYears."' AND '".$endYears."' 
               AND a.dept LIKE '%".$dept."%' ";
          // echo $stQuery;
          // exit();
          $query   = $this->db->query($stQuery);
          return $query->getResultArray();
    }

    public function getWorkDayMonth($startYears, $endYears, $dept, $biodataId)
    {
         $stQuery = "SELECT SUM(work_day) AS WD FROM rp_db WHERE date_process BETWEEN '".$startYears."' AND '".$endYears."' AND dept LIKE '%".$dept."%' 
         AND biodata_id = '".$biodataId."'";
          // echo $stQuery;
          // exit();
          $query   = $this->db->query($stQuery);
          return $query->getRowArray();
    }

     public function getAllDept($startYears, $endYears, $dept)
     {
          $stQuery = "SELECT DISTINCT dept FROM rp_db WHERE date_process BETWEEN '".$startYears."' AND '".$endYears."' ";

          if($dept!='alldept'){
               $stQuery .= " AND dept LIKE '%".$dept."%' ";
          }
          
          $query   = $this->db->query($stQuery);
          return $query->getResultArray();
     }

     public function getAllEmpByDept($startYears, $endYears, $dept)
     {
          $stQuery = "SELECT DISTINCT a.biodata_id, b.monthly FROM rp_db a, mt_salary b WHERE a.biodata_id = b.biodata_id AND a.date_process BETWEEN '".$startYears."' AND '".$endYears."' AND dept = '".$dept."' ";
          // echo $stQuery;
          // exit();
          $query   = $this->db->query($stQuery);
          return $query->getResultArray();
     }

     public function getTotalWorkDay($startYears, $endYears, $dept)
     {
           $stQuery = "SELECT SUM(work_day) AS WD FROM rp_db WHERE date_process BETWEEN '".$startYears."' AND '".$endYears."' AND dept = '".$dept."'";
          // echo $stQuery;
          // exit();
          $query   = $this->db->query($stQuery);
          return $query->getRowArray();
     }

     public function getAlldeptData($startDate, $endDate, $dept){
          $stQuery  = " SELECT DISTINCT a.biodata_id, a.slip_id, a.full_name, a.dept, a.position FROM tr_slip a WHERE a.date_process BETWEEN '".$startDate."' 
                         AND '".$endDate."'";
          if($dept!='alldept'){
               $stQuery .= " AND a.dept LIKE '%".$dept."%' ";
          }
          $stQuery .= " GROUP BY a.full_name ";
          // echo $stQuery;
          // exit();

          $query = $this->db->query($stQuery)->getResultArray();

          return $query;
     
     }

     public function get_wd_monthly($biodata_id,$start,$end){
          $stQuery = "SELECT COUNT(db_id) wd FROM `db_hris_daily`.`rp_db` WHERE biodata_id='".$biodata_id."' AND in_db>0 AND out_db>0 
                         AND date_process BETWEEN '".$start."' AND '".$end."'";

          $dt_wd   = $this->db->query($stQuery)->getRowArray();
          return $dt_wd;
     }

}