<?php

namespace App\Models\Report;

/*********************************************************************
 *  Created By       :  Generator Version 1.0.23                     *
 *  Created Date     :  Apr 06, 2022                                 *
 *  Description      : All code generated by model generator         *
 *  Generator Author : Tommy Maurice(tommy_maurice@yahoo.com)        *
 *********************************************************************/

use CodeIgniter\Model;

class M_tax_calculation extends Model
{
     function getDataTableTax($tahun)
     {
          $stQuery = "SELECT b.full_name,id_card_no,b.tax_no,b.marital_status,b.bpjs_status,c.`monthly` basic_salary,a.*
                         FROM `db_hris_daily`.`tr_slip` a
                         JOIN mt_biodata_01 b ON a.`biodata_id`=b.`biodata_id`
                         JOIN mt_salary c ON a.`biodata_id`=c.`biodata_id`
                         WHERE a.year_period = '" . $tahun . "' AND b.`emp_status`='Monthly' AND a.client_name IS NULL
                         GROUP BY a.`biodata_id`
                         ORDER BY a.biodata_id, a.`year_period`, a.`month_period`";

          $query = $this->db->query($stQuery)->getResultArray();
          return $query;
     }

     function getDataTableTaxByClient($tahun, $clientName)
     {
          $stQuery = "SELECT b.full_name,id_card_no,b.tax_no,b.marital_status,b.bpjs_status,c.`monthly` basic_salary,a.*
                         FROM `db_hris_daily`.`tr_slip` a
                         JOIN mt_biodata_01 b ON a.`biodata_id`=b.`biodata_id`
                         JOIN mt_salary c ON a.`biodata_id`=c.`biodata_id`
                         WHERE a.year_period = '" . $tahun . "' AND a.client_name = '" . $clientName . "' 
                         GROUP BY a.`biodata_id`
                         ORDER BY a.biodata_id, a.`year_period`, a.`month_period`";
          // dd($stQuery);
          $query = $this->db->query($stQuery)->getResultArray();
          return $query;
     }

     function getAllDataTaxEmpl($tahun, $id)
     {
          $stQuery  = "SELECT b.full_name,id_card_no,b.tax_no,b.marital_status,b.bpjs_status,b.bpjs_no,c.`monthly` basic_salary,a.*
                         FROM `db_hris_daily`.`tr_slip` a
                         JOIN mt_biodata_01 b ON a.`biodata_id`=b.`biodata_id`
                         JOIN mt_salary c ON a.`biodata_id`=c.`biodata_id`
                         WHERE a.year_period = '" . $tahun . "' AND b.`emp_status`='Monthly' AND a.biodata_id='" . $id . "'
                         ORDER BY a.biodata_id, a.`year_period`, a.`month_period`";
          $query    = $this->db->query($stQuery)->getResultArray();
          return $query;
     }
}
